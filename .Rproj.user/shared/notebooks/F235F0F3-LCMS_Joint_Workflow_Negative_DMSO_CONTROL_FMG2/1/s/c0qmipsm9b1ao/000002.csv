"0","plotChromPeakImageRTmin <- function (x, binSize = 30, xlim = NULL, log = FALSE, xlab = ""retention time"","
"0","  yaxt = par(""yaxt""), main = ""Chromatographic peak counts"","
"0","  ...)"
"0","{"
"0","  min2sec <- 60"
"0","  if (!is(x, ""XCMSnExp""))"
"0","    stop(""'x' is supposed to be an 'XCMSnExp' object, but I got a "","
"0","      class(x))"
"0","  if (is.null(xlim))"
"0","    xlim <- c(floor(min(rtime(x))), ceiling(max(rtime(x))))"
"0","  brks <- seq(xlim[1], xlim[2], by = binSize)"
"0","  if (brks[length(brks)] < xlim[2])"
"0","    brks <- c(brks, brks[length(brks)] + binSize)"
"0","  pks <- chromPeaks(x, rt = xlim)"
"0","  if (nrow(pks)) {"
"0","    rts <- split(pks[, ""rt""], pks[, ""sample""])"
"0","    cnts <- lapply(rts, function(z) {"
"0","      hst <- hist(z, breaks = brks, plot = FALSE)"
"0","      hst$counts"
"0","    })"
"0","    n_samples <- length(fileNames(x))"
"0","    sample_idxs <- 1:n_samples"
"0","    sample_idxs <- sample_idxs[!(as.character(sample_idxs) %in%"
"0","      names(rts))]"
"0","    if (length(sample_idxs)) {"
"0","      all_cnts <- vector(""list"", n_samples)"
"0","      all_cnts[as.numeric(names(cnts))] <- cnts"
"0","      zeros <- rep(0, (length(brks) - 1))"
"0","      all_cnts[sample_idxs] <- list(zeros)"
"0","      cnts <- all_cnts"
"0","    }"
"0","    cnts <- t(do.call(rbind, cnts))"
"0","    if (log)"
"0","      cnts <- log2(cnts)"
"0","    image(z = cnts, x = (brks - (brks[2] - brks[1])/2) / min2sec, xaxs = ""r"","
"0","      xlab = xlab, yaxt = ""n"", ...)"
"0","    if (yaxt != ""n"")"
"0","      axis(side = 2, at = seq(0, 1, length.out = n_samples),"
"0","        labels = basename(fileNames(x)), las = 2)"
"0","  }"
"0","}"
